***************
*** 1,3 ****
  require 'set'
  require 'tempfile'
  
--- 1,5 ----
+ # coding=binary
+ 
  require 'set'
  require 'tempfile'
  
*************** module Rack
*** 351,357 ****
            input = env['rack.input']
            input.rewind
  
-           boundary_size = boundary.size + EOL.size
            bufsize = 16384
  
            content_length -= boundary_size
--- 353,359 ----
            input = env['rack.input']
            input.rewind
  
+           boundary_size = Utils.bytesize(boundary) + EOL.size
            bufsize = 16384
  
            content_length -= boundary_size
